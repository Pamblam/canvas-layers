<!DOCTYPE html>
<html>
	<head>
		<title>test</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<style>canvas, img{border:1px solid black}</style>
	</head>
	<body style="background: lightblue; text-align:center;">
		<h3>Canvas Test</h3>
		<canvas id=canvas width="1200" height="800" style="border:1px solid black; width:600px; height:400px; margin:0 auto; background: white;"></canvas> 
		<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNiYAAAAAkAAxkR2eQAAAAASUVORK5CYII=" id="preview">
		
		<script src="../canvas-layers.min.js"></script>
		<script>
			
			var preview = document.getElementById('preview');
			var canvasEle = document.getElementById("canvas");
			var canvas = new Canvas(canvasEle);
			
			const blankImg = './img/squareboard.png';
			const redSqImg = './img/red_square.png';
			const bluCircl = './img/blue_circle.png';
			
			var third = canvas.width / 3;
			var half = canvas.width / 2;
			
			canvas.addLayer(redSqImg, {
				name: 'Red Square', 
				x: third,
				rotateable: false,
				selectable: false,
				draggable: false,
				resizable: false
			});
			
			canvas.addLayer(bluCircl, {
				name: 'Blue Circle', 
				x: third*2,
				rotateable: false,
				selectable: false,
				draggable: false,
				resizable: false
			});
			
			var invisible_box = canvas.addLayer(blankImg, {
				name: 'Select Area', 
				x: half,
				width: 300,
				height: 300
			});
			
			canvas.selectLayer(invisible_box);
			
			cropit();
			
			canvasEle.addEventListener('layer-deselect', function(e){
				e.preventDefault();
			});
			
			canvasEle.addEventListener('layer-drag', cropit);
			canvasEle.addEventListener('layer-rotate', cropit);
			canvasEle.addEventListener('layer-resize', cropit);
			
			function cropit(){
				canvas.cropToLayer(invisible_box).then(datauri=>{
					preview.src = datauri;
				});
			}
			
		</script>
	</body>
</html>
